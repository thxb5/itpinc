<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sample">	
	<select id="selectBoardList" parameterType="hashmap" resultType="hashmap">
		<include refid="common.pagingPre"/>
		<![CDATA[
			SELECT
				ROW_NUMBER() OVER (ORDER BY IDX DESC) RNUM,
				IDX,
				TITLE,
				HIT_CNT,
				CREA_DTM
			FROM
				TB_BOARD
			WHERE
				DEL_GB = 'N'
		]]>
		<!-- 무슨 조건으로 할건지 생각 ,,,
			카테고리(콤보박스)를 선택해서 값이 넘겨오면 그 값에 해당하는 결과를 가져오게 만들어야 함,,,
			1. 만약 category !=NULL and category.equals("idx")
				AND idx = #{search}
			2. 만약 caregory.equals("title")'%" + search + "%'"
				AND title like '%'||#{search}||'%'
			3. 만약 category.equals("content")
				AND content like '%'||#{search}||'%'
		 -->
		<!-- 'idx'.equals(category) -->
		<if test="category !=null and category.equals('idx')">
   			AND idx like '%'||#{search}||'%'
 		</if> 
		<if test="category !=null and category.equals('title')">
   			AND title like '%'||#{search}||'%'
 		</if>
		<if test="category !=null and category.equals('contents')">
   			AND contents like '%'||#{search}||'%'
 		</if>

		<include refid="common.pagingPost"/>
	</select>
	
	<insert id="insertBoard" parameterType="hashmap" useGeneratedKeys="true" keyProperty="IDX">
		<selectKey keyProperty="IDX" resultType="string" order="BEFORE">
			SELECT SEQ_TB_BOARD_IDX.NEXTVAL FROM DUAL
		</selectKey>
		<![CDATA[
        	INSERT INTO TB_BOARD
        	(
            	IDX,
            	TITLE, 
            	CONTENTS, 
            	HIT_CNT, 
            	DEL_GB, 
            	CREA_DTM, 
            	CREA_ID
       		 )
        	VALUES
        	(
            	#{IDX},
            	#{TITLE,jdbcType=VARCHAR}, 
            	#{CONTENTS,jdbcType=VARCHAR}, 
            	0, 
            	'N', 
            	SYSDATE, 
            	'Admin'
        	)
		]]>
	</insert>
	
	<!-- <update id="updateHitCnt" parameterType="hashmap">
		<![CDATA[
			UPDATE TB_BOARD
			SET
				HIT_CNT = NVL(HIT_CNT,0)+1 
			WHERE
				IDX=#{IDX]
		]]>
	</update> --><!-- HIT_CNT 가 null일경우, 두번째 반환 -->
	
	<update id="updateHitCnt" parameterType="hashmap">
		<![CDATA[
			UPDATE TB_BOARD
			SET HIT_CNT = HIT_CNT + 1
			WHERE IDX=#{IDX}
		]]>
	
	</update>

	<select id="selectBoardDetail" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			
			SELECT
				IDX,
				HIT_CNT,
				CREA_ID,
				CREA_DTM,
				TITLE,
				CONTENTS
			FROM
				TB_BOARD
			WHERE
				IDX=#{IDX}
			
		]]>

</select>

<select id="selectBoardDetail1" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			
			SELECT
				IDX,
				HIT_CNT,
				CREA_ID,
				CREA_DTM,
				TITLE,
				CONTENTS
			FROM
				TB_BOARD
			WHERE
				IDX =(SELECT NVL(MIN(IDX), '123') FROM TB_BOARD WHERE IDX >#{IDX})
				

		]]>

</select>

<select id="selectBoardDetail2" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			
			SELECT
				IDX,
				HIT_CNT,
				CREA_ID,
				CREA_DTM,
				TITLE,
				CONTENTS
			FROM
				TB_BOARD
			WHERE
				IDX =(SELECT MAX(IDX) FROM TB_BOARD WHERE IDX <#{IDX}) 
		]]>

</select>

	<select id="boardUpdate" parameterType="hashmap" resultType="hashmap">
		<!-- <![CDATA[
			UPDATE TB_BOARD
			SET
				TITLE = #{TITLE}, 
				CONTENTS = #{CONTENTS}
			WHERE
				IDX = #{IDX}
		]]> -->
		<![CDATA[
			SELECT
			 	IDX,
			 	HIT_CNT,
			 	CREA_ID,
			 	CREA_DTM,
			 	TITLE,
			 	CONTENTS
			 FROM
			 	TB_BOARD
			 WHERE IDX=#{IDX}
		]]>
	</select>
	
	<update id="updateBoard" parameterType="hashmap">
		<![CDATA[
			UPDATE TB_BOARD
			SET TITLE=#{TITLE},
				CONTENTS=#{CONTENTS}
			WHERE
				IDX=#{IDX}
		]]>
	</update>
	
	<delete id="deleteBoard" parameterType="hashmap">
		<!-- <![CDATA[
			DELETE FROM
			TB_BOARD
			WHERE IDX=#{IDX}
		]]> -->
		<![CDATA[
			UPDATE TB_BOARD
			SET DEL_GB = 'Y'
			WHERE IDX=#{IDX}
		]]>
		
	</delete>
	
	<insert id="insertFile" parameterType="hashmap">
		<![CDATA[
			INSERT INTO TB_FILE
			(
				IDX,
				BOARD_IDX,
				ORIGINAL_FILE_NAME,
				STORED_FILE_NAME,
				FILE_SIZE,
				CREA_ID
			)
			VALUES
			(
				SEQ_TB_FILE_IDX.NEXTVAL,
				#{BOARD_IDX},
				#{ORIGINAL_FILE_NAME},
				#{STORED_FILE_NAME},
				#{FILE_SIZE},
				'Admin'
			)
		]]>
	</insert>
	
	<select id="selectFileList" parameterType="hashmap" resultType="hashmap">
		<![CDATA[
			SELECT
				IDX,
				ORIGINAL_FILE_NAME,
				ROUND(FILE_SIZE/1024,1) AS FILE_SIZE
			FROM
				TB_FILE
			WHERE
				BOARD_IDX=#{IDX}
				AND DEL_GB='N'
		]]>
	</select>
	
	<update id="deleteFileList" parameterType="hashmap">
		<![CDATA[
			UPDATE TB_FILE SET
				DEL_GB='Y'
			WHERE
				BOARD_IDX=#{IDX}
		]]>
	</update>
	
	<update id="updateFile" parameterType="hashmap">
		<![CDATA[
			UPDATE TB_FILE SET
				DEL_GB='N'
			WHERE
				IDX=#{FILE_IDX}
		]]>
	</update>
	
	<!-- <![CDATA...요건 혹시모를 쿼리문에 <,> 등의 기호가 들어갈때를 대비하여 씀 -->
</mapper>